Based on http://make.mad-scientist.net/papers/advanced-auto-dependency-generation/
